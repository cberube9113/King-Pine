<!DOCTYPE html>
<html>
<head>
  <title>app.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "app.js", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#app.js">app.js</a>
      </div>
      <div class="heading h2">
        <a href="#main-server-file">Main server file</a>
      </div>
      <div class="heading h3">
        <a href="#module-and-route-dependencies.">Module and route dependencies.</a>
      </div>
      <div class="heading h3">
        <a href="#configuration-for-app.js">Configuration for app.js</a>
      </div>
      <div class="heading h3">
        <a href="#get-commands">GET Commands</a>
      </div>
      <div class="heading h4">
        <a href="#basic-get-commands-to-run-the-specified-route-when-it-is-entered-in-the-url.">Basic GET commands to run the specified route when it is entered in the URL.</a>
      </div>
      <div class="heading h4">
        <a href="#get-commands-for-the-documentation-and-functional-spec--redirects-to-the-files-themselves.">GET commands for the documentation and functional spec, redirects to the files themselves.</a>
      </div>
      <div class="heading h3">
        <a href="#post-commands">POST Commands</a>
      </div>
      <div class="heading h4">
        <a href="#runs-when-a-user-tries-to-authenticate--redirects-to-user-sessions-and-checks-for-login-permission.">Runs when a user tries to authenticate, redirects to user-sessions and checks for login permission.</a>
      </div>
      <div class="heading h4">
        <a href="#runs-when-a-user-tries-to-logout--redirects-to-user-sessions-and-runs-logout-command.">Runs when a user tries to logout, redirects to user-sessions and runs logout command.</a>
      </div>
      <div class="heading h4">
        <a href="#runs-when-a-new-user-is-created--on-the-index-page-.">Runs when a new user is created (on the index page).</a>
      </div>
      <div class="heading h4">
        <a href="#runs-when-a-new-chirp-is-made-by-a-user--via-the-home-page-.">Runs when a new chirp is made by a user (via the home page).</a>
      </div>
      <div class="heading h4">
        <a href="#runs-when-a-user-enters-a-search-in-the-search-box">Runs when a user enters a search in the search box</a>
      </div>
      <div class="heading h4">
        <a href="#redirects-user-to-functional-spec.">Redirects user to functional spec.</a>
      </div>
      <div class="heading h3">
        <a href="#individual-user-pages">Individual User Pages</a>
      </div>
      <div class="heading h4">
        <a href="#individual-page--like-me-page--for-each-user.">Individual page, like Me page, for each user.</a>
      </div>
      <div class="heading h3">
        <a href="#logic-to-render-the-404-page-if-anything-unexpected-is-visited.">Logic to render the 404 page if anything unexpected is visited.</a>
      </div>
      <div class="heading h3">
        <a href="#starts-server-listening-on-specified-port--set-in-configuration-.">Starts server listening on specified port (set in configuration).</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
<div class="pilwrap" id="app.js">
  <h1>
    <a href="#app.js" class="pilcrow">&#182;</a>
    app.js
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="main-server-file">
  <h2>
    <a href="#main-server-file" class="pilcrow">&#182;</a>
    Main server file
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="module-and-route-dependencies.">
  <h3>
    <a href="#module-and-route-dependencies." class="pilcrow">&#182;</a>
    Module and route dependencies.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)</span> 
  <span class="p">,</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/index&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">home</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/home&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">connect</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/connect&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">discover</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/discover&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">login</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/login&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">me</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/me&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">signup</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/signup&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">auth</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/user-sessions&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">flash</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;connect-flash&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./lib/user&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">chirps</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./lib/chirps&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">follow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./lib/follow&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">Sequelize</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sequelize&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="configuration-for-app.js">
  <h3>
    <a href="#configuration-for-app.js" class="pilcrow">&#182;</a>
    Configuration for app.js
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3000</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">,</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/views&#39;</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;views&#39;</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;view engine&#39;</span><span class="p">,</span> <span class="s1">&#39;ejs&#39;</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">favicon</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">logger</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">));</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">cookieParser</span><span class="p">(</span><span class="s1">&#39;your secret here&#39;</span><span class="p">));</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">session</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">flash</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">router</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">)));</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="s1">&#39;development&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">());</span>
<span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="get-commands">
  <h3>
    <a href="#get-commands" class="pilcrow">&#182;</a>
    GET Commands
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="basic-get-commands-to-run-the-specified-route-when-it-is-entered-in-the-url.">
  <h4>
    <a href="#basic-get-commands-to-run-the-specified-route-when-it-is-entered-in-the-url." class="pilcrow">&#182;</a>
    Basic GET commands to run the specified route when it is entered in the URL.
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">index</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">,</span> <span class="nx">home</span><span class="p">.</span><span class="nx">list</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/connect&#39;</span><span class="p">,</span> <span class="nx">connect</span><span class="p">.</span><span class="nx">list</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/discover&#39;</span><span class="p">,</span> <span class="nx">discover</span><span class="p">.</span><span class="nx">list</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="nx">index</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/signup&#39;</span><span class="p">,</span> <span class="nx">index</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/me&#39;</span><span class="p">,</span> <span class="nx">me</span><span class="p">.</span><span class="nx">list</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="get-commands-for-the-documentation-and-functional-spec--redirects-to-the-files-themselves.">
  <h4>
    <a href="#get-commands-for-the-documentation-and-functional-spec--redirects-to-the-files-themselves." class="pilcrow">&#182;</a>
    GET commands for the documentation and functional spec, redirects to the files themselves.
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/docs&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;docs/index.js.html&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/spec&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;docs/funcspec.pdf&#39;</span><span class="p">);</span>
<span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="post-commands">
  <h3>
    <a href="#post-commands" class="pilcrow">&#182;</a>
    POST Commands
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="runs-when-a-user-tries-to-authenticate--redirects-to-user-sessions-and-checks-for-login-permission.">
  <h4>
    <a href="#runs-when-a-user-tries-to-authenticate--redirects-to-user-sessions-and-checks-for-login-permission." class="pilcrow">&#182;</a>
    Runs when a user tries to authenticate, redirects to user-sessions and checks for login permission.
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/auth&#39;</span><span class="p">,</span> <span class="nx">auth</span><span class="p">.</span><span class="nx">auth</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="runs-when-a-user-tries-to-logout--redirects-to-user-sessions-and-runs-logout-command.">
  <h4>
    <a href="#runs-when-a-user-tries-to-logout--redirects-to-user-sessions-and-runs-logout-command." class="pilcrow">&#182;</a>
    Runs when a user tries to logout, redirects to user-sessions and runs logout command.
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">,</span> <span class="nx">auth</span><span class="p">.</span><span class="nx">logout</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="runs-when-a-new-user-is-created--on-the-index-page-.">
  <h4>
    <a href="#runs-when-a-new-user-is-created--on-the-index-page-." class="pilcrow">&#182;</a>
    Runs when a new user is created (on the index page).
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/new-user&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>Parameters set based on the fields in the form.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">name</span><span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">email</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">;</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>Checks if all the fields were filled in when the user tries to submit.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">username</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">email</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">password</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>If they were, adds the user to the database and informs them that they were created.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;authsucc&#39;</span><span class="p">,</span><span class="s1">&#39;User &#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39; was successfully created. You can now log in as &#39;</span> <span class="o">+</span> <span class="nx">username</span><span class="p">);</span> 
    <span class="nx">user</span><span class="p">.</span><span class="nx">addUser</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">email</span><span class="p">,</span><span class="nx">password</span><span class="p">,</span><span class="nx">username</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>Otherwise fails the creation and informs the user to fill in all the fields.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="s1">&#39;Please make sure you have filled out all fields of the Join form&#39;</span><span class="p">);</span> 
  <span class="p">}</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
<span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="runs-when-a-new-chirp-is-made-by-a-user--via-the-home-page-.">
  <h4>
    <a href="#runs-when-a-new-chirp-is-made-by-a-user--via-the-home-page-." class="pilcrow">&#182;</a>
    Runs when a new chirp is made by a user (via the home page).
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/new-chirp&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Parameters set based on currently logged in user.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">uid</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">idlookup</span><span class="p">(</span><span class="nx">username</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>Parameter set based on field in form.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">data</span><span class="o">=</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">chirp</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>Parameter to be set based on current date in future.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">date</span><span class="o">=</span><span class="s2">&quot;Just now.&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>Runs the addChirp function from the <em>chirps</em> library file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">chirps</span><span class="p">.</span><span class="nx">addChirp</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="nx">date</span><span class="p">,</span><span class="nx">uid</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Redirects a user back to home after the chirp has been made.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">);</span>
<span class="p">});</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="runs-when-a-user-enters-a-search-in-the-search-box">
  <h4>
    <a href="#runs-when-a-user-enters-a-search-in-the-search-box" class="pilcrow">&#182;</a>
    Runs when a user enters a search in the search box
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/search/:query&#39;</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">autocomplete</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="redirects-user-to-functional-spec.">
  <h4>
    <a href="#redirects-user-to-functional-spec." class="pilcrow">&#182;</a>
    Redirects user to functional spec.
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/spec&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;docs/funcspec.pdf&#39;</span><span class="p">);</span>
<span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="individual-user-pages">
  <h3>
    <a href="#individual-user-pages" class="pilcrow">&#182;</a>
    Individual User Pages
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="individual-page--like-me-page--for-each-user.">
  <h4>
    <a href="#individual-page--like-me-page--for-each-user." class="pilcrow">&#182;</a>
    Individual page, like Me page, for each user.
  </h4>
</div>


<p><em>This request must be below all other one-directory routes.</em></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/:user&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">user</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span> <span class="c1">//If the user exists in the database, load their page.</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>Sets parameters based on the username in the page URL.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="kd">var</span> <span class="nx">u</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">nameOfSearchedUser</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">nameFromUsername</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">following</span> <span class="o">=</span> <span class="nx">follow</span><span class="p">.</span><span class="nx">numfollowing</span><span class="p">(</span><span class="nx">u</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">followers</span> <span class="o">=</span> <span class="nx">follow</span><span class="p">.</span><span class="nx">numfollowers</span><span class="p">(</span><span class="nx">u</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">nchirps</span> <span class="o">=</span> <span class="nx">chirps</span><span class="p">.</span><span class="nx">numchirps</span><span class="p">(</span><span class="nx">u</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">chirpdata</span> <span class="o">=</span> <span class="nx">chirps</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">u</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">){</span> <span class="c1">//If there is a user logged in</span>
      <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">isfollowing</span> <span class="o">=</span> <span class="nx">follow</span><span class="p">.</span><span class="nx">isFollowing</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">u</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span><span class="p">{</span> <span class="c1">//If there is not a user logged in</span>
      <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">isfollowing</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Renders searchresults page, which is a copy of the Me page but with a modified subject.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;searchresults&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Search Results&#39;</span><span class="p">,</span>
                     <span class="nx">following</span><span class="o">:</span> <span class="nx">following</span><span class="p">,</span>
                     <span class="nx">followers</span><span class="o">:</span> <span class="nx">followers</span><span class="p">,</span>
                     <span class="nx">nchirps</span><span class="o">:</span> <span class="nx">nchirps</span><span class="p">,</span>
                     <span class="nx">chirpdata</span><span class="o">:</span> <span class="nx">chirpdata</span><span class="p">,</span>
                     <span class="nx">user</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
                     <span class="nx">isfollowing</span><span class="o">:</span> <span class="nx">isfollowing</span><span class="p">,</span>
                     <span class="nx">u</span><span class="o">:</span> <span class="nx">u</span><span class="p">,</span>
                     <span class="nx">nameOfSearchedUser</span><span class="o">:</span> <span class="nx">nameOfSearchedUser</span>
                  <span class="p">});</span>
    <span class="p">}</span>

  <span class="k">else</span><span class="p">{</span> <span class="c1">//If the user does not exist, inform the searcher and give them an opportunity to create it.</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span><span class="s1">&#39;That user doesn\&#39;t exist.  Would you like to create that user?&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/follow/:user&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">u</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">uid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">fid</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">idlookup</span><span class="p">(</span><span class="nx">u</span><span class="p">);</span>
  <span class="nx">follow</span><span class="p">.</span><span class="nx">followdbUpdate</span><span class="p">(</span><span class="nx">uid</span><span class="p">,</span><span class="nx">fid</span><span class="p">);</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">u</span><span class="p">);</span>
<span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="logic-to-render-the-404-page-if-anything-unexpected-is-visited.">
  <h3>
    <a href="#logic-to-render-the-404-page-if-anything-unexpected-is-visited." class="pilcrow">&#182;</a>
    Logic to render the 404 page if anything unexpected is visited.
  </h3>
</div>


<p>THIS MUST BE THE VERY LAST CODE BEFORE THE SERVER IS STARTED  </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
 
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;404&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;404&#39;</span>
            <span class="p">});</span>
<span class="p">});</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>Create server.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>WebSockets/Socket.IO</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">io</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;socket.io&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;log level&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">chirpApp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes/chirp-socket&#39;</span><span class="p">);</span>

<span class="nx">io</span><span class="p">.</span><span class="nx">sockets</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">socket</span><span class="p">){</span>
  <span class="nx">chirpApp</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">socket</span><span class="p">);</span>
<span class="p">});</span>
  


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="starts-server-listening-on-specified-port--set-in-configuration-.">
  <h3>
    <a href="#starts-server-listening-on-specified-port--set-in-configuration-." class="pilcrow">&#182;</a>
    Starts server listening on specified port (set in configuration).
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Express server listening on port &quot;</span> <span class="o">+</span> <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
