<!DOCTYPE html>
<html>
<head>
  <title>sql.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../", thisFile = "lib/sql.js", defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#user-database-functions">User Database Functions</a>
      </div>
      <div class="heading h2">
        <a href="#adduser">addUser</a>
      </div>
      <div class="heading h2">
        <a href="#deluser">delUser</a>
      </div>
      <div class="heading h2">
        <a href="#getuser">getUser</a>
      </div>
      <div class="heading h2">
        <a href="#doesuserexist">doesUserExist</a>
      </div>
      <div class="heading h2">
        <a href="#autocomplete">autocomplete</a>
      </div>
      <div class="heading h1">
        <a href="#chirp-database-functions">Chirp database functions</a>
      </div>
      <div class="heading h2">
        <a href="#addchirp">addChirp</a>
      </div>
      <div class="heading h2">
        <a href="#getnumchirps">getNumChirps</a>
      </div>
      <div class="heading h2">
        <a href="#homechirps">homeChirps</a>
      </div>
      <div class="heading h2">
        <a href="#discoverychirps">discoveryChirps</a>
      </div>
      <div class="heading h2">
        <a href="#mechirps">meChirps</a>
      </div>
      <div class="heading h1">
        <a href="#follow-database-functions">Follow database functions</a>
      </div>
      <div class="heading h2">
        <a href="#getfollowing">getFollowing</a>
      </div>
      <div class="heading h2">
        <a href="#isfollowing">isFollowing</a>
      </div>
      <div class="heading h2">
        <a href="#addfollow">addFollow</a>
      </div>
      <div class="heading h2">
        <a href="#delfollow">delFollow</a>
      </div>
      <div class="heading h2">
        <a href="#getnumfollowing">getNumFollowing</a>
      </div>
      <div class="heading h2">
        <a href="#getnumfollowers">getNumFollowers</a>
      </div>
      <div class="heading h2">
        <a href="#getfolloweesforuser">getFolloweesForUser</a>
      </div>
      <div class="heading h2">
        <a href="#getfollowersforuser">getFollowersForUser</a>
      </div>
      <div class="heading h1">
        <a href="#users">Users</a>
      </div>
      <div class="heading h2">
        <a href="#login">login</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>sql.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">sqlite3</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sqlite3&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>Connect to the database which has already been created.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sqlite3</span><span class="p">.</span><span class="nx">Database</span><span class="p">(</span><span class="s1">&#39;./data/326.sqlite.db&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="user-database-functions">
  <h1>
    <a href="#user-database-functions" class="pilcrow">&#182;</a>
    User Database Functions
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="adduser">
  <h2>
    <a href="#adduser" class="pilcrow">&#182;</a>
    addUser
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>Add user to the <strong>users</strong> table
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>uid</strong> User's uid.  By setting this to NULL, the uid will be set to the next available uid. <br />
&nbsp;&nbsp; <strong>name</strong> User's full name <br />
&nbsp;&nbsp; <strong>email</strong> User's email address <br />
&nbsp;&nbsp; <strong>username</strong> User's username <br />
&nbsp;&nbsp; <strong>password</strong> User's password <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return, but the table in the database is updated.  </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">addUser</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;INSERT INTO users VALUES (NULL,?,?,?,?)&#39;</span><span class="p">,[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">]);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="deluser">
  <h2>
    <a href="#deluser" class="pilcrow">&#182;</a>
    delUser
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>Delete user from <strong>users</strong> table <br />
This is not currently implemented, but may be in the future. <br />
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>uid</strong> User's uid. <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return, the user is deleted from the database.  </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="nx">exports</span><span class="p">.</span><span class="nx">delUser</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uid</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;DELETE FROM users WHERE uid=?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">uid</span><span class="p">]);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="getuser">
  <h2>
    <a href="#getuser" class="pilcrow">&#182;</a>
    getUser
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>Get a user from <strong>users</strong> table <br />
<div class="highlight"> <br />
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>username</strong> Username of the user you want <br />
&nbsp;&nbsp; <strong>cb</strong> Callback. First parameter is the error, second is an object for the user. <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return  </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getUser</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM users where username=?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="doesuserexist">
  <h2>
    <a href="#doesuserexist" class="pilcrow">&#182;</a>
    doesUserExist
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>Determine whether a user exists in the database
<div class="highlight"> <br />
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>username</strong> Username of the user you want <br />
&nbsp;&nbsp; <strong>cb</strong> Callback. First parameter is the error, second is an object whose 'count' property is either 0 or 1. <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return  </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">doesUserExist</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;SELECT EXISTS (SELECT 1 FROM users WHERE username=?)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="autocomplete">
  <h2>
    <a href="#autocomplete" class="pilcrow">&#182;</a>
    autocomplete
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>Autocomplete function <br />
To be used with our AJAX functionality for user search <br />
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>req and res</strong> Standard reqest/response parameters. <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; <strong>res.send(names)</strong>  Sends the array made in the function.  </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">autocomplete</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>Set the global variables.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">names</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">tableLength</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">curname</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">curusername</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>Set tableLength to be the number of users registered.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;SELECT COUNT(uid) AS count FROM users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">tl</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span><span class="p">{</span>
        <span class="nx">tableLength</span> <span class="o">=</span> <span class="nx">tl</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">count</span><span class="p">;</span>
        
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>Pull all usernames and names from the table, then do the comparison on each row.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;SELECT name,username FROM users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">){</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
            <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">else</span><span class="p">{</span>
            <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">tableLength</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span> <span class="c1">//For each element in the table, set the two variables</span>
              <span class="nx">curname</span> <span class="o">=</span> <span class="nx">user</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">;</span>
              <span class="nx">curusername</span> <span class="o">=</span> <span class="nx">user</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">username</span><span class="p">;</span>

              <span class="k">if</span><span class="p">(</span><span class="nx">curname</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//If we have a match, push that match to the global array names.</span>
                <span class="nx">names</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">curname</span><span class="p">);</span>
                <span class="nx">names</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">curusername</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">names</span><span class="p">);</span>
          
        <span class="p">}</span> 
      <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span> 



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="chirp-database-functions">
  <h1>
    <a href="#chirp-database-functions" class="pilcrow">&#182;</a>
    Chirp database functions
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="addchirp">
  <h2>
    <a href="#addchirp" class="pilcrow">&#182;</a>
    addChirp
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>Add chirp function <br />
Takes in the data of a chirp and adds it to the chirp table. <br />
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>data</strong> The content of the chirp. <br />
&nbsp;&nbsp; <strong>uid</strong> the User ID of the user who made the chirp. <br />
&nbsp;&nbsp; <strong>date</strong> The timestamp of the chirp. <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return, inserts chirp into database.  </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">addChirp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">uid</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;INSERT INTO chirps VALUES(NULL,?,?,?,?,?)&#39;</span><span class="p">,[</span><span class="nx">data</span><span class="p">,</span> <span class="nx">uid</span><span class="p">,</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">name</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;SQLite error!&quot;</span><span class="p">);</span>   
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="getnumchirps">
  <h2>
    <a href="#getnumchirps" class="pilcrow">&#182;</a>
    getNumChirps
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Retrieve the number of chirps a user has made <br />
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>userid</strong> The userid of the user whose count you want <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. First parameter is the error, second is an object whose 'count' property is the count. <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return.  </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getNumChirps</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;SELECT COUNT(uid) AS count FROM chirps WHERE uid=?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">userid</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="homechirps">
  <h2>
    <a href="#homechirps" class="pilcrow">&#182;</a>
    homeChirps
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>Pull chirps to populate the home page <br />
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>dbInput</strong> String created dynamically in home route <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. First input is the error, second is an array of chirp objects <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return.  </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">homeChirps</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dbInput</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">dbInput</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="discoverychirps">
  <h2>
    <a href="#discoverychirps" class="pilcrow">&#182;</a>
    discoveryChirps
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>Pull chirps to populate the discovery page <br />
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. First input is the error, second is an array of chirp objects <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">discoveryChirps</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM chirps ORDER BY timestamp DESC LIMIT 5&#39;</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="mechirps">
  <h2>
    <a href="#mechirps" class="pilcrow">&#182;</a>
    meChirps
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Pull chirps to populate the me page <br />
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>userid</strong> userid of the user whose chirps you want <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. First input is the error, second is an array of chirp objects <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return. </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">meChirps</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM chirps WHERE uid=? ORDER BY timestamp DESC&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">userid</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="follow-database-functions">
  <h1>
    <a href="#follow-database-functions" class="pilcrow">&#182;</a>
    Follow database functions
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="getfollowing">
  <h2>
    <a href="#getfollowing" class="pilcrow">&#182;</a>
    getFollowing
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>Pull chirps to populate the me page <br />
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>userid</strong> userid of the user whose chirps you want <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. First input is the error, second is an array of objects for each user the original user is following. Each contains an 'fid' property. <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return. </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getFollowing</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;SELECT fid FROM follow WHERE uid=?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">userid</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="isfollowing">
  <h2>
    <a href="#isfollowing" class="pilcrow">&#182;</a>
    isFollowing
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>Is uid following fid? <br />
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>uid</strong> userid of the user doing the following <br />
&nbsp;&nbsp; <strong>fid</strong> userid of the user being followed <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. First input is the error, second an object whose 'count' property is either 0 or 1 <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return. </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">isFollowing</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uid</span><span class="p">,</span> <span class="nx">fid</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;SELECT EXISTS (SELECT 1 FROM follow WHERE uid=? AND fid=?)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">uid</span><span class="p">,</span> <span class="nx">fid</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="addfollow">
  <h2>
    <a href="#addfollow" class="pilcrow">&#182;</a>
    addFollow
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34">&#182;</a>
</div>
<p>Add an entry to allow uid to follow fid
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>uid</strong> userid of the user doing the following <br />
&nbsp;&nbsp; <strong>fid</strong> userid of the user being followed <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return. </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">addFollow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uid</span><span class="p">,</span> <span class="nx">fid</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;INSERT INTO follow VALUES (?,?)&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">uid</span><span class="p">,</span><span class="nx">fid</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="delfollow">
  <h2>
    <a href="#delfollow" class="pilcrow">&#182;</a>
    delFollow
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36">&#182;</a>
</div>
<p>Delete an entry in the follow database
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>uid</strong> userid of the user doing the following <br />
&nbsp;&nbsp; <strong>fid</strong> userid of the user being followed <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; No return. </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">delFollow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uid</span><span class="p">,</span> <span class="nx">fid</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;DELETE FROM follow WHERE uid=? AND fid=?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">uid</span><span class="p">,</span><span class="nx">fid</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="getnumfollowing">
  <h2>
    <a href="#getnumfollowing" class="pilcrow">&#182;</a>
    getNumFollowing
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38">&#182;</a>
</div>
<p>Number of users subject is following
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>uid</strong> userid of the user you want the info about <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. First argument is the error, second is an object whose 'count' property is either 0 or 1 <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; <strong>object</strong> Countains count of people user is following  </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getNumFollowing</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;SELECT COUNT(uid) AS count FROM follow WHERE uid=?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">userid</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="getnumfollowers">
  <h2>
    <a href="#getnumfollowers" class="pilcrow">&#182;</a>
    getNumFollowers
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<p>Number of followers the user has
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>uid</strong> userid of the user you want the info about <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. First argument is the error, second is an object whose 'count' property is either 0 or 1 <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; <strong>object</strong> Contains count of people who are following user  </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getNumFollowers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;SELECT COUNT(uid) AS count FROM follow WHERE fid=?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">userid</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="getfolloweesforuser">
  <h2>
    <a href="#getfolloweesforuser" class="pilcrow">&#182;</a>
    getFolloweesForUser
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<p>Users subject is following
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>uid</strong> userid of the user you want the info about <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. First argument is the error, second is an object containing names and usernames <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; <strong>object</strong> Contains users </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="nx">exports</span><span class="p">.</span><span class="nx">getFolloweesForUser</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;SELECT name, username FROM users inner join follow on follow.fid = users.uid WHERE follow.uid = ?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">userid</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="getfollowersforuser">
  <h2>
    <a href="#getfollowersforuser" class="pilcrow">&#182;</a>
    getFollowersForUser
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44">&#182;</a>
</div>
<p>Users following subject
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>uid</strong> userid of the user you want the info about <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. First argument is the error, second is an object containing names and usernames <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; <strong>object</strong> Contains users </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="nx">exports</span><span class="p">.</span><span class="nx">getFollowersForUser</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;SELECT name, username FROM users inner join follow on follow.uid = users.uid WHERE follow.fid = ?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">userid</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="users">
  <h1>
    <a href="#users" class="pilcrow">&#182;</a>
    Users
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="login">
  <h2>
    <a href="#login" class="pilcrow">&#182;</a>
    login
  </h2>
</div>


<p>Check the user database for correct login credentials <br />
<div class="highlight">
<strong>Parameters</strong> <br />
&nbsp;&nbsp; <strong>username</strong> Username in the login form <br />
&nbsp;&nbsp; <strong>password</strong> Password in the login form <br />
&nbsp;&nbsp; <strong>cb</strong> Callback function. First argument is the error, second is a message to flash if the credentials are wrong, third is the userobject if the credentials are correct <br />
<strong>Returns</strong> <br />
&nbsp;&nbsp; <strong>object</strong> User object   </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">login</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM users WHERE username=?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">users</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">users</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
      <span class="nx">cb</span><span class="p">(</span><span class="s1">&#39;User not found!&#39;</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
      <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM users WHERE username=? AND password=?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">users</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">users</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
          <span class="nx">cb</span><span class="p">(</span><span class="s1">&#39;Password is incorrect.&#39;</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">users</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
          <span class="nx">cb</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">users</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
